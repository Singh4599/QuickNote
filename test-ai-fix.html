<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test AI Fix</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
    <h1 class="text-2xl font-bold mb-6">üß™ Test AI Diagnostics Fix</h1>
    
    <div class="space-y-4">
      <div>
        <h3 class="font-semibold">Test Symptom Analysis</h3>
        <textarea id="symptomText" class="w-full p-3 border rounded" placeholder="Enter symptoms to test...">I have chest pain and shortness of breath</textarea>
        <button onclick="testAnalysis()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Test Analysis
        </button>
      </div>
      
      <div id="results" class="mt-6 p-4 bg-gray-50 rounded hidden">
        <h4 class="font-semibold mb-2">Results:</h4>
        <div id="resultContent"></div>
      </div>
      
      <div id="errors" class="mt-6 p-4 bg-red-50 border border-red-200 rounded hidden">
        <h4 class="font-semibold text-red-700 mb-2">Errors:</h4>
        <div id="errorContent" class="text-red-600"></div>
      </div>
      
      <div id="console" class="mt-6 p-4 bg-black text-green-400 rounded font-mono text-sm h-64 overflow-y-auto">
        <div class="text-yellow-400">Console Output:</div>
      </div>
    </div>
  </div>

  <script>
    // Capture console logs
    const consoleDiv = document.getElementById('console');
    const originalLog = console.log;
    const originalError = console.error;
    
    function addToConsole(message, type = 'log') {
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? 'text-red-400' : 'text-green-400';
      consoleDiv.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      addToConsole(args.join(' '), 'log');
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      addToConsole(args.join(' '), 'error');
    };
    
    async function testAnalysis() {
      const text = document.getElementById('symptomText').value;
      const resultsDiv = document.getElementById('results');
      const errorsDiv = document.getElementById('errors');
      const resultContent = document.getElementById('resultContent');
      const errorContent = document.getElementById('errorContent');
      
      console.log('üß™ Starting AI analysis test...');
      
      try {
        // Clear previous results
        resultsDiv.classList.add('hidden');
        errorsDiv.classList.add('hidden');
        
        // Check if AIDiagnosticsSimple is available
        if (!window.AIDiagnosticsSimple) {
          throw new Error('AIDiagnosticsSimple not loaded');
        }
        
        console.log('‚úÖ AIDiagnosticsSimple found');
        
        // Create instance and test
        const aiDiagnostics = new window.AIDiagnosticsSimple();
        console.log('‚úÖ AIDiagnosticsSimple instance created');
        
        // Test the analysis method directly
        const mockReport = {
          id: 'test-123',
          file_name: 'Test Analysis',
          file_type: 'text',
          original_text: text
        };
        
        const result = await aiDiagnostics.callAIAnalysis(mockReport, null, text);
        console.log('‚úÖ Analysis completed successfully');
        
        // Display results
        resultContent.innerHTML = `
          <div class="space-y-2">
            <div><strong>Summary:</strong> ${result.summary}</div>
            <div><strong>Risk Level:</strong> ${result.risk_level}</div>
            <div><strong>Key Findings:</strong> ${result.key_findings.join(', ')}</div>
          </div>
        `;
        resultsDiv.classList.remove('hidden');
        
      } catch (error) {
        console.error('‚ùå Test failed:', error);
        errorContent.textContent = error.message;
        errorsDiv.classList.remove('hidden');
      }
    }
    
    console.log('üöÄ Test page loaded');
  </script>
  
  <!-- Load the AI diagnostics scripts -->
  <script src="js/gemini-ai-medical.js"></script>
  <script src="js/ai-diagnostics-simple.js"></script>
</body>
</html>
