<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediVerse AI - Authentication Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen py-8">
  <div class="container mx-auto px-4 max-w-4xl">
    <div class="bg-white rounded-lg shadow-lg p-8">
      <h1 class="text-3xl font-bold text-center mb-8 text-slate-800">
        <i class="fas fa-stethoscope text-blue-600 mr-3"></i>
        MediVerse AI - Authentication Test
      </h1>
      
      <!-- Test Results -->
      <div id="testResults" class="space-y-4 mb-8">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 class="font-semibold text-blue-800 mb-2">
            <i class="fas fa-info-circle mr-2"></i>
            Running Tests...
          </h3>
          <div id="testOutput" class="text-sm text-blue-700">
            Please wait while we test all components...
          </div>
        </div>
      </div>

      <!-- Quick Test Forms -->
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Signup Test -->
        <div class="bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 text-slate-800">
            <i class="fas fa-user-plus text-green-600 mr-2"></i>
            Quick Signup Test
          </h3>
          <form id="quickSignup" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
              <select id="signupRole" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <option value="patient">Patient</option>
                <option value="doctor">Doctor</option>
                <option value="hospital">Hospital</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
              <input type="text" id="signupName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter name">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input type="email" id="signupEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="test@example.com">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <input type="password" id="signupPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="password123">
            </div>
            <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
              <i class="fas fa-user-plus mr-2"></i>
              Test Signup
            </button>
          </form>
        </div>

        <!-- Login Test -->
        <div class="bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 text-slate-800">
            <i class="fas fa-sign-in-alt text-blue-600 mr-2"></i>
            Quick Login Test
          </h3>
          <form id="quickLogin" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input type="email" id="loginEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="test@example.com">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <input type="password" id="loginPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="password123">
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
              <i class="fas fa-sign-in-alt mr-2"></i>
              Test Login
            </button>
          </form>
        </div>
      </div>

      <!-- Navigation Links -->
      <div class="mt-8 text-center space-x-4">
        <a href="index.html" class="inline-block bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
          <i class="fas fa-home mr-2"></i>
          Home
        </a>
        <a href="signup.html" class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
          <i class="fas fa-user-plus mr-2"></i>
          Signup Page
        </a>
        <a href="login.html" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
          <i class="fas fa-sign-in-alt mr-2"></i>
          Login Page
        </a>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/toast.js"></script>
  <script src="js/loader.js"></script>

  <script>
    let testOutput = document.getElementById('testOutput');
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
      testOutput.innerHTML += `<div class="mb-1">[${timestamp}] ${icon} ${message}</div>`;
      testOutput.scrollTop = testOutput.scrollHeight;
    }

    // Run comprehensive tests
    async function runTests() {
      log('Starting comprehensive authentication tests...');
      
      // Test 1: Check globals
      log('Testing global variables...');
      if (window.supabaseClient) log('Supabase client: Available', 'success');
      else log('Supabase client: Missing', 'error');
      
      if (window.CONFIG) log('CONFIG: Available', 'success');
      else log('CONFIG: Missing', 'error');
      
      if (window.Auth) log('Auth: Available', 'success');
      else log('Auth: Missing', 'error');
      
      // Test 2: Supabase connection
      try {
        log('Testing Supabase connection...');
        const { data, error } = await supabaseClient.from('hospitals').select('count').limit(1);
        if (error) throw error;
        log('Supabase connection: Working', 'success');
      } catch (err) {
        log(`Supabase connection: Failed - ${err.message}`, 'error');
      }
      
      log('Tests completed! You can now test signup/login forms below.');
    }

    // Quick signup test
    document.getElementById('quickSignup').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const role = document.getElementById('signupRole').value;
      const name = document.getElementById('signupName').value;
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      
      if (!name || !email || !password) {
        log('Please fill all fields', 'error');
        return;
      }
      
      log(`Attempting signup for ${role}: ${email}`);
      
      try {
        const result = await Auth.signUp(email, password, {
          fullName: name,
          role: role
        });
        
        if (result.success) {
          log(`Signup successful! ${result.message}`, 'success');
        } else {
          log(`Signup failed: ${result.error}`, 'error');
        }
      } catch (err) {
        log(`Signup error: ${err.message}`, 'error');
      }
    });

    // Quick login test
    document.getElementById('quickLogin').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        log('Please fill all fields', 'error');
        return;
      }
      
      log(`Attempting login: ${email}`);
      
      try {
        const result = await Auth.signIn(email, password);
        
        if (result.success) {
          log('Login successful! Redirecting...', 'success');
        } else {
          log(`Login failed: ${result.error}`, 'error');
        }
      } catch (err) {
        log(`Login error: ${err.message}`, 'error');
      }
    });

    // Initialize when DOM loads
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(runTests, 1000);
    });
  </script>
</body>
</html>
